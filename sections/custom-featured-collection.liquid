{% comment %}
  Section: Custom Featured Collection
  Path: sections/custom-featured-collection.liquid
{% endcomment %}

{{ 'component-card.css' | asset_url | stylesheet_tag }}
{{ 'component-price.css' | asset_url | stylesheet_tag }}
{{ 'component-slider.css' | asset_url | stylesheet_tag }}
{{ 'template-collection.css' | asset_url | stylesheet_tag }}

{%- style -%}
  .section-{{ section.id }}-padding {
    padding-top: {{ section.settings.padding_top | times: 0.75 | round: 0 }}px;
    padding-bottom: {{ section.settings.padding_bottom | times: 0.75 | round: 0 }}px;
  }

  @media screen and (min-width: 750px) {
    .section-{{ section.id }}-padding {
      padding-top: {{ section.settings.padding_top }}px;
      padding-bottom: {{ section.settings.padding_bottom }}px;
    }
  }

  .collection__title--{{ section.settings.heading_alignment }} {
    text-align: {{ section.settings.heading_alignment }};
  }

  .collection__button-container--{{ section.settings.button_alignment }} {
    text-align: {{ section.settings.button_alignment }};
    margin-top: {{ section.settings.button_spacing }}px;
  }

  .collection__button-container .button,
  .collection__view-all .button {
    background-color: {{ section.settings.button_background_color }};
    transition: background-color 0.3s ease, transform 0.3s ease;
  }
  .collection__button-container .button:hover,
  .collection__view-all .button:hover {
    transform: translateY(-3px);
    opacity: 0.9;
  }

  /* Remove previous keyframe usage; keep typography only */
  #collection-{{ section.id }} .title {
    font-size: {{ section.settings.heading_size }}px;
  }
  #collection-{{ section.id }} .collection__description {
    font-size: {{ section.settings.subheading_size }}px;
  }

  .custom-product-card {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;

    /* Simple fade animation */
    opacity: 0;
    transition: opacity 0.6s ease;
  }
  .custom-product-card.in-view {
    opacity: 1;
  }

  /* Image hover swap preserved */
  .custom-product-card__image-wrapper {
    position: relative;
    width: 100%;
    overflow: hidden;
    border-radius: 10px;
    perspective: 1000px;
  }

  .custom-product-card__image {
    width: 100%;
    height: auto;
    object-fit: cover;
    transition: opacity 0.6s ease, transform 0.6s ease;
    display: block;
    will-change: transform;
  }

  .custom-product-card__image--primary { opacity: 1; }
  .custom-product-card__image--secondary {
    position: absolute; top: 0; left: 0; opacity: 0;
  }
/* Only swap images if card has a secondary image */
.custom-product-card.has-secondary-image:hover .custom-product-card__image--primary {
  opacity: 0;
}
.custom-product-card.has-secondary-image:hover .custom-product-card__image--secondary {
  opacity: 1;
}

/* Zoom effect can stay for all cards (optional) */
.custom-product-card:hover .custom-product-card__image {
  transform: scale(1.08);
}


  .custom-product-card__title {
    font-size: 1rem;
    font-weight: 900;
    margin: 0;
    color: #000;
    transition: color 0.3s ease;
  }

  .custom-product-card__title a { text-decoration: none; color: inherit; font-size: large; font-weight: 600; }
  .custom-product-card__title:hover { color: #5c7e63; }

  .custom-product-card__description {
    font-size: 16px;
    /* color: #6c6c6c; */
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
    margin: 0;
  }

  .custom-product-card__price {
    font-size: 20px;
    font-weight: 700;
    margin-top: auto;
    transition: color 0.3s ease;
  }

  .custom-product-card__price:hover { color: #ffa55d; }

  .product-grid-wrapper-{{ section.id }} {
    padding-top: {{ section.settings.product_row_padding_top }}px;
    padding-bottom: {{ section.settings.product_row_padding_bottom }}px;
  }






  /* Ensure all product cards are same height */
.custom-product-card {
  display: flex;
  flex-direction: column;
  height: 100%;
}

/* Make the content area push price to the bottom */
.custom-product-card__description {
  min-height: 40px; /* adjust as needed */
}

.custom-product-card__title {
  min-height: 45px; /* makes all titles equal height */
}

/* Push price to bottom */
.custom-product-card__price {
  margin-top: auto;
}


h3.custom-product-card__title {
    line-height: 15px;
}


{%- endstyle -%}

{%- liquid
  assign products_to_display = section.settings.collection.all_products_count
  if section.settings.collection.all_products_count > section.settings.products_to_show
    assign products_to_display = section.settings.products_to_show
    assign more_in_collection = true
  endif
  assign columns_mobile_int = section.settings.columns_mobile | plus: 0
  assign columns_desktop_int = section.settings.columns_desktop | plus: 0
  assign max_columns_to_show = columns_mobile_int
  if columns_desktop_int > columns_mobile_int
    assign max_columns_to_show = columns_desktop_int
  endif
-%}

<div class="color-{{ section.settings.color_scheme }} isolate gradient">
  <div class="collection section-{{ section.id }}-padding{% if section.settings.full_width %} collection--full-width{% endif %}" id="collection-{{ section.id }}" data-id="{{ section.id }}">
    <div class="collection__title title-wrapper title-wrapper--no-top-margin page-width collection__title--{{ section.settings.heading_alignment }}">
      {%- if section.settings.title != blank -%}<h2 class="title inline-richtext">{{ section.settings.title }}</h2>{%- endif -%}
      {%- if section.settings.description != blank or section.settings.show_description and section.settings.collection.description != empty -%}
        <div class="collection__description {{ section.settings.description_style }} rte">
          {%- if section.settings.show_description -%}{{ section.settings.collection.description }}{%- else -%}{{ section.settings.description -}}{%- endif %}
        </div>
      {%- endif -%}
    </div>

    <slider-component class="slider-mobile-gutter{% if section.settings.full_width %} slider-component-full-width{% endif %}">
      <div class="page-width product-grid-wrapper-{{ section.id }}">
        <ul id="Slider-{{ section.id }}" data-id="{{ section.id }}" class="grid product-grid grid--{{ section.settings.columns_desktop }}-col-desktop grid--{{ section.settings.columns_mobile }}-col-tablet-down" role="list">
          {%- if section.settings.collection.products.size > 0 -%}
            {% paginate section.settings.collection.products by section.settings.products_to_show %}
              {%- for product in section.settings.collection.products limit: section.settings.products_to_show -%}
                <li class="grid__item">
                  {% comment %} <div class="custom-product-card"> {% endcomment %}
                   <div class="custom-product-card{% if product.images.size > 1 %} has-secondary-image{% endif %}">

                    <a href="{{ product.url }}">
                      <div class="custom-product-card__image-wrapper">
                        <img src="{{ product.featured_image | img_url: '600x' }}" alt="{{ product.featured_image.alt | escape }}" class="custom-product-card__image custom-product-card__image--primary" loading="lazy">
                        {% if product.images.size > 1 %}
                          <img src="{{ product.images[1] | img_url: '600x' }}" alt="{{ product.images[1].alt | escape }}" class="custom-product-card__image custom-product-card__image--secondary" loading="lazy">
                        {% endif %}
                      </div>
                    </a>
                    <h3 class="custom-product-card__title"><a href="{{ product.url }}">{{ product.title }}</a></h3>
                    {%- if section.settings.show_product_description and product.description != blank -%}
                      <p class="custom-product-card__description">{{ product.description | strip_html | truncatewords: 20 }}</p>
                    {%- endif -%}
                    <div class="custom-product-card__price">{{ product.price | money }}</div>
                  </div>
                </li>
              {%- endfor -%}
            {% endpaginate %}
          {%- else -%}
            <li class="grid__item">
              <div class="custom-product-card">
                <img src="{{ 'product-placeholder.svg' | asset_url }}" alt="Placeholder" class="custom-product-card__image">
                <h3 class="custom-product-card__title">Sample Product</h3>
                <p class="custom-product-card__description">This is a sample description for a placeholder product.</p>
                <div class="custom-product-card__price">$0.00</div>
              </div>
            </li>
          {%- endif -%}
        </ul>
      </div>
    </slider-component>

   {%- if section.settings.show_view_all and more_in_collection -%}
  <div class="collection__button-container collection__button-container--{{ section.settings.button_alignment }} page-width">
    <a href="{{ section.settings.collection.url }}" class="button orange-btn">
      {{ section.settings.view_all_label | escape }}
    </a>
  </div>
{%- endif -%}

  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function() {
    const cards = document.querySelectorAll("#collection-{{ section.id }} .custom-product-card");

    /* Simple fade-in / fade-out on viewport */
    const observer = new IntersectionObserver(entries => {
      entries.forEach(entry => {
        const card = entry.target;
        if (entry.isIntersecting) {
          card.classList.add('in-view');
        } else {
          card.classList.remove('in-view');
        }
      });
    }, { threshold: 0.2 });

    cards.forEach(card => observer.observe(card));

    /* Parallax-style zoom effect (kept as-is) */
    const wrappers = document.querySelectorAll("#collection-{{ section.id }} .custom-product-card__image-wrapper");
    wrappers.forEach(wrapper => {
      wrapper.addEventListener("mousemove", e => {
        const img = wrapper.querySelector(".custom-product-card__image--primary") || wrapper.querySelector(".custom-product-card__image");
        const rect = wrapper.getBoundingClientRect();
        const x = (e.clientX - rect.left) / rect.width - 0.5;
        const y = (e.clientY - rect.top) / rect.height - 0.5;
        img.style.transform = `scale(1.1) translate(${x*15}px, ${y*15}px)`;
      });
      wrapper.addEventListener("mouseleave", () => {
        const img = wrapper.querySelector(".custom-product-card__image--primary") || wrapper.querySelector(".custom-product-card__image");
        img.style.transform = "scale(1)";
      });
    });
  });
</script>

{% schema %}
{
  "name": "Featured Collection",
  "tag": "section",
  "class": "section",
  "settings": [
    { "type": "collection", "id": "collection", "label": "Collection" },
    { "type": "range", "id": "products_to_show", "min": 2, "max": 25, "step": 1, "default": 4, "label": "Products to show" },
    { "type": "inline_richtext", "id": "title", "default": "Featured Collection", "label": "Title" },
    { "type": "richtext", "id": "description", "label": "Description" },
    { "type": "checkbox", "id": "show_description", "label": "Show collection description", "default": false },
    { "type": "checkbox", "id": "show_product_description", "label": "Show product description", "default": true },
    { "type": "select", "id": "heading_alignment", "label": "Heading & description alignment", "options": [ { "value": "left", "label": "Left" }, { "value": "center", "label": "Center" }, { "value": "right", "label": "Right" } ], "default": "center" },
    { "type": "range", "id": "heading_size", "min": 14, "max": 60, "step": 1, "default": 28, "label": "Heading size (px)" },
    { "type": "range", "id": "subheading_size", "min": 10, "max": 40, "step": 1, "default": 16, "label": "Subheading size (px)" },
    { "type": "range", "id": "columns_desktop", "min": 1, "max": 6, "step": 1, "default": 4, "label": "Desktop columns" },
    { "type": "select", "id": "columns_mobile", "default": "2", "label": "Mobile columns", "options": [{ "value": "1", "label": "1" }, { "value": "2", "label": "2" }] },
    { "type": "checkbox", "id": "swipe_on_mobile", "default": false, "label": "Enable swipe on mobile" },
    { "type": "checkbox", "id": "enable_desktop_slider", "default": false, "label": "Enable desktop slider" },
    { "type": "checkbox", "id": "full_width", "default": false, "label": "Full width" },
    { "type": "checkbox", "id": "show_view_all", "default": true, "label": "Show View All button" },
    { "type": "text", "id": "view_all_label", "label": "View All button label", "default": "View all" },
    { "type": "select", "id": "button_alignment", "label": "Button alignment", "options": [{ "value": "left", "label": "Left" }, { "value": "center", "label": "Center" }, { "value": "right", "label": "Right" }], "default": "center" },
    { "type": "color", "id": "button_background_color", "label": "Button background color", "default": "#000000" },
    { "type": "range", "id": "padding_top", "min": 0, "max": 100, "step": 4, "default": 36, "label": "Section padding top" },
    { "type": "range", "id": "padding_bottom", "min": 0, "max": 100, "step": 4, "default": 36, "label": "Section padding bottom" },
    { "type": "range", "id": "product_row_padding_top", "min": 0, "max": 100, "step": 4, "default": 20, "label": "Product row padding top" },
    { "type": "range", "id": "product_row_padding_bottom", "min": 0, "max": 100, "step": 4, "default": 20, "label": "Product row padding bottom" }
  ],
  "presets": [{ "name": "Featured Collection" }]
}
{% endschema %}
